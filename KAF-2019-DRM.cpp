#include <iostream>
#include "windows.h"
#include <emmintrin.h>
#include "TLSCallback.h"
#include "AntiDebug.h"
#include "VirtualMachine.h"


int main()
{
#ifndef _DEBUG
	if (IsDebuggerPresent())
	{
		//Extremely simple red herring for anti debugging
		puts("DON'T DEBUG ME!!!!");
		exit(1337);
	}
#endif
	unsigned char opcodes[] = { 0xab,0x01,0x00,0x00,0x00,0x00,0xcd,0x00,0x00,0x01,0x00,0xcd,0x00,0x73,0x00,0x08,0x00,0x01,0x00,0xcd,0x00,0x73,0x00,0x10,0x00,0x01,0x00,0xcd,0x00,0x73,0x00,0x18,0x00,0x01,0x00,0xab,0x02,0x4b,0x41,0x46,0x7b,0xff,0x01,0x02,0xcd,0x00,0xab,0x01,0x7d,0x00,0x00,0x00,0xff,0x01,0x00 };
	std::cout << "Welcome to the DRM challenge. Please enter your flag to win: ";
	
	runVmCode(opcodes, sizeof(opcodes));

	return 0;
}
